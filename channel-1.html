<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CRIC NEWS POINT - Fixed</title>

  <!-- Plyr CSS -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { --accent: #1db954; }
    html,body{
      margin:0; padding:0;
      font-family: 'Poppins', sans-serif;
      background:#0a0a0a; color:#e6e6e6;
    }

    /* Header */
    header {
      position: fixed; top:0; left:0; right:0;
      height:70px;
      background: rgba(10,10,10,0.85);
      backdrop-filter: blur(5px);
      display:flex; align-items:center; justify-content:center;
      border-bottom:1px solid rgba(255,255,255,0.06);
      z-index:9999;
    }
    header img { height:85%; filter: drop-shadow(0 0 8px rgba(29,185,84,0.25)); transition:filter .25s; }
    header:hover img { filter: drop-shadow(0 0 12px rgba(29,185,84,0.45)); }
    .menu-icon { position:absolute; left:16px; color:#fff; font-size:30px; cursor:pointer; }

    /* Video container */
    .video-container {
      width:100vw; aspect-ratio:16/9; background:#000;
      margin-top:70px; box-shadow:0 10px 30px rgba(0,0,0,0.6);
    }
    #player { width:100%; height:100%; object-fit:contain; display:block; background:#000; }

    /* Tabs */
    .tabs {
      display:flex; justify-content:space-around; background:#0f0f0f;
      border-top:1px solid rgba(51,51,51,0.5); border-bottom:1px solid rgba(51,51,51,0.5);
    }
    .tab-button {
      flex:1; padding:14px 0; color:#b0b0b0; background:none; border:none; cursor:pointer;
      display:flex; gap:8px; align-items:center; justify-content:center; font-weight:500;
      transition: all .18s ease;
    }
    .tab-button .material-icons { font-size:20px; transition:transform .18s ease; }
    .tab-button:hover{ color:#fff; background: rgba(255,255,255,0.02); }
    .tab-button.active{ color:var(--accent); font-weight:600; }
    .tab-button.active .material-icons{ color:var(--accent); text-shadow:0 0 10px rgba(29,185,84,0.35); }

    .tab-content { display:none; padding-bottom:30px; background: #0a0a0a; }
    .tab-content.active { display:block; animation: fadeIn .28s ease; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

    /* News list */
    .news-list { list-style:none; margin:0; padding:16px; max-width:900px; margin-left:auto; margin-right:auto; }
    .news-item {
      background:#151515; border-radius:10px; padding:12px; margin-bottom:14px;
      box-shadow: 0 3px 14px rgba(0,0,0,0.6); transition: transform .14s ease, box-shadow .14s ease;
    }
    .news-item:hover { transform: translateY(-4px); box-shadow: 0 6px 20px rgba(0,0,0,0.75); }
    .news-item-image { width:100%; max-height:220px; object-fit:cover; border-radius:8px; display:block; margin-bottom:8px; background:#222; }
    .news-item-title { font-size:1.12rem; font-weight:700; color:#fff; margin-bottom:6px; }
    .news-item-desc { color:#bdbdbd; font-size:0.98rem; line-height:1.35; margin-bottom:6px; }
    .news-item a { color:var(--accent); text-decoration:none; font-weight:600; }

    /* Highlights iframe */
    #highlights iframe { width:100%; height:520px; border:none; display:block; }

    /* Sidebar */
    .sidebar {
      position: fixed; top:0; left:-280px; width:280px; height:100vh; background: rgba(255,255,255,0.03);
      backdrop-filter: blur(18px); border-right:1px solid rgba(255,255,255,0.03);
      padding-top:80px; transition:left .28s ease; z-index:9998;
      box-shadow: 4px 0 20px rgba(0,0,0,0.6);
      border-top-right-radius:12px; border-bottom-right-radius:12px;
    }
    .sidebar.open{ left:0; }
    .sidebar a { display:block; padding:14px 20px; color:#fff; text-decoration:none; border-bottom:1px solid rgba(255,255,255,0.03); }
    .overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:9997; }
    .overlay.show{ display:block; }

    /* Popup styles (kept as original look) */
    .popup-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:10002;
    }
    .popup-box {
      width: 320px; background: rgba(20,20,30,0.6); border:1px solid rgba(173,216,230,0.18);
      border-radius: 20px; backdrop-filter: blur(15px); padding: 1.8rem 1.2rem; text-align:center;
      box-shadow: 0 0 25px rgba(0,255,255,0.4);
      position: relative; animation: popIn .45s ease;
    }
    @keyframes popIn { from{ transform:scale(.96); opacity:0 } to{ transform:scale(1); opacity:1 } }
    .popup-header { font-size:1.6rem; font-weight:700; background: linear-gradient(45deg,#00eaff,#bd00ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:6px; text-shadow:0 0 8px rgba(0,255,255,0.3); }
    .popup-subtitle { color:#aaa; margin-bottom:10px; }
    .popup-buttons { display:flex; flex-direction:column; gap:10px; }
    .popup-btn { padding:10px; border-radius:10px; font-weight:600; cursor:pointer; border:none; background:rgba(255,255,255,0.05); color:#fff; }
    .join-btn { background: linear-gradient(135deg,#00eaff,#9c00ff); box-shadow:0 0 12px rgba(0,255,255,0.25); }
    .close-btn { position:absolute; top:10px; right:12px; font-size:1.2rem; color:#00eaff; background:none; border:none; cursor:pointer; }

    /* small screens */
    @media (max-width:600px){
      #highlights iframe { height:420px; }
      .news-item-image { max-height:160px; }
    }
  </style>
</head>
<body>

  <!-- Visitor Counter Popup (hidden by default) -->
  <div class="popup-overlay" id="visitorPopup" style="display:none;">
    <div class="popup-box">
      <button class="close-btn" onclick="closeVisitorPopup()">×</button>
      <div class="popup-header">Total Visitors</div>
      <div class="popup-subtitle">Users Live On Web</div>
      <div style="margin-top:10px;">
        <img src="https://visit-counter.vercel.app/counter.png?page=cricnewspoints.pages.dev&s=45&c=ffff00&bg=00000000&no=1&ff=digi&tb=&ta=" alt="Visitor" style="height:48px;">
      </div>
    </div>
  </div>

  <!-- Telegram Join Popup (kept as original) -->
  <div class="popup-overlay" id="popup">
    <div class="popup-box">
      <button class="close-btn" onclick="closePopup()">×</button>
      <div class="popup-header">Support Us!</div>
      <div class="popup-subtitle">Join our WhatsApp for latest updates.</div>
      <div class="popup-buttons">
        <a href="https://whatsapp.com/channel/0029VaeylYYBPzjVNomWuZ0T" target="_blank" class="popup-btn join-btn">Join Now</a>
        <button class="popup-btn" onclick="closePopup()">Already Joined</button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <span class="material-icons menu-icon" onclick="toggleSidebar()">menu</span>
    <img src="https://i.ibb.co/wrwhDqqq/Picsart-25-09-18-09-51-55-084.png" alt="Logo">
  </header>

  <!-- Video Player -->
  <div class="video-container">
    <video id="player" playsinline controls></video>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div style="padding:0 12px; color:#ccc; font-weight:600; padding-bottom:8px;">MENU</div>
    <a href="https://whatsapp.com/channel/0029VaeylYYBPzjVNomWuZ0T" target="_blank">Join Our WhatsApp</a>
    <a href="https://wa.me/message/UXWYI3QA7SKIA1" target="_blank">Contact Us</a>
    <a href="https://sayan-mete.onrender.com/copyright" target="_blank">Copyright</a>
    <a href="#" onclick="showVisitorPopup()">Total Visitor</a>
  </div>
  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-button active" data-tab="news"><span class="material-icons">article</span> News</button>
    <button class="tab-button" data-tab="highlights"><span class="material-icons">movie</span> Highlights</button>
  </div>

  <!-- News Tab -->
  <div id="news" class="tab-content active">
    <ul class="news-list" id="newsList"><li>Loading news...</li></ul>
  </div>

  <!-- Highlights Tab (kept normal size and behavior) -->
  <div id="highlights" class="tab-content">
    <iframe src="https://cricketstan.github.io/Top-moments-/" loading="lazy" referrerpolicy="no-referrer"></iframe>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

  <script>
    /* ----------------------
       Video player (HLS + Plyr)
       ---------------------- */
    const jsonUrl = 'https://raw.githubusercontent.com/StmpupCricket/Star-Sports-Hindi-json/refs/heads/main/data.json';

    (async function initPlayer(){
      try {
        const resp = await fetch(jsonUrl, {cache: "no-store"});
        const meta = await resp.json();
        const m3u8 = meta.stream_url;
        const video = document.getElementById('player');

        if (Hls.isSupported()) {
          const hls = new Hls({maxBufferLength:30});
          hls.loadSource(m3u8);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, function() {
            // build qualities list
            const qualities = hls.levels
              .map(l => l.height || 0)
              .filter((v,i,a) => a.indexOf(v)===i)
              .sort((a,b)=>b-a);

            const player = new Plyr(video, {
              controls: ['play','progress','current-time','mute','volume','settings','fullscreen'],
              settings: ['quality','speed'],
              quality: {
                default: qualities[0] || null,
                options: qualities,
                forced: false,
                onChange: q => {
                  const level = hls.levels.findIndex(l => l.height === q);
                  hls.currentLevel = level;
                }
              }
            });
            // try autoplay
            video.play().catch(()=>{/* ignore autoplay block */});
          });
          hls.on(Hls.Events.ERROR, function(event, data){
            // handle fatal errors gracefully
            if(data.fatal){
              console.error('HLS fatal error', data);
            }
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = m3u8;
          video.addEventListener('loadedmetadata', ()=> {
            new Plyr(video, {
              controls: ['play','progress','current-time','mute','volume','settings','fullscreen'],
              settings: ['quality','speed']
            });
            video.play().catch(()=>{});
          });
        } else {
          console.warn('HLS not supported in this browser.');
        }
      } catch (err) {
        console.error('Failed to init player', err);
      }
    })();

    /* ----------------------
       Tab switching (robust)
       ---------------------- */
    document.querySelectorAll('.tab-button').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const tab = btn.getAttribute('data-tab');
        switchTab(tab);
      });
    });

    function switchTab(tabId){
      // remove active
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      // add
      const btn = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
      if(btn) btn.classList.add('active');
      const content = document.getElementById(tabId);
      if(content) content.classList.add('active');
    }

    /* ----------------------
       Sidebar toggle
       ---------------------- */
    function toggleSidebar(){
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('show');
    }

    /* ----------------------
       Popup functions (original behavior preserved)
       ---------------------- */
    function closePopup(){ document.getElementById('popup').style.display = 'none'; }
    function closeVisitorPopup(){
      const p = document.getElementById('visitorPopup');
      p.querySelector('.popup-box').style.opacity = '0';
      setTimeout(()=> p.style.display = 'none', 260);
    }
    function showVisitorPopup(){
      const popup = document.getElementById('visitorPopup');
      popup.style.display = 'flex';
      // small fade-in
      popup.querySelector('.popup-box').style.opacity = '1';
    }

    /* ----------------------
       News loader (image + title + description + link)
       ---------------------- */
    async function loadNews(){
      const ul = document.getElementById('newsList');
      ul.innerHTML = '<li>Loading...</li>';
      try {
        const res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://timesofindia.indiatimes.com/rssfeeds/4719148.cms");
        const data = await res.json();
        ul.innerHTML = '';
        const items = (data.items || []).slice(0, 12);
        if(items.length === 0){
          ul.innerHTML = '<li>No news found.</li>';
          return;
        }
        items.forEach(item => {
          const li = document.createElement('li');
          li.className = 'news-item';
          // image: enclosure or find in description
          let imageUrl = '';
          if(item.enclosure && item.enclosure.link) imageUrl = item.enclosure.link;
          else if(item.description){
            const m = item.description.match(/<img[^>]+src=["']([^"']+)["']/);
            if(m) imageUrl = m[1];
          }
          const safeDesc = item.description ? item.description.replace(/<[^>]+>/g,'').replace(/&nbsp;/g,' ').trim() : '';
          const descShort = safeDesc.length > 160 ? safeDesc.slice(0,160) + '...' : safeDesc;
          li.innerHTML = `
            ${ imageUrl ? `<img class="news-item-image" src="${imageUrl}" alt="thumb" loading="lazy">` : '' }
            <div class="news-item-title">${escapeHtml(item.title)}</div>
            <div class="news-item-desc">${escapeHtml(descShort)}</div>
            <a href="${item.link}" target="_blank" rel="noopener noreferrer">Read More</a>
          `;
          ul.appendChild(li);
        });
      } catch (err) {
        console.error('News load error', err);
        ul.innerHTML = '<li>News could not be loaded. Please try again later.</li>';
      }
    }

    // basic escape to avoid injecting raw html
    function escapeHtml(str){
      if(!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    loadNews();
    // refresh every 3 minutes (180000 ms)
    setInterval(loadNews, 180000);

    /* optional: show telegram popup after a short delay (like original behaviour some had) */
    // if you don't want auto-show, comment this out
    // setTimeout(()=> { /* leave popup visible by default as original code had it visible */ }, 1200);

  </script>
</body>
</html>