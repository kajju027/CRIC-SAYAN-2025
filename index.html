<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CricMail</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
body {
  background: #000;
  font-family: Arial, sans-serif;
  padding-bottom: 20px; /* Adds spacing at the bottom */
}
header {
  position: fixed; top:0; left:0; width:100%; height:60px;
  background:rgba(0,0,0,1); display:flex; align-items:center;
  z-index:1000; border-bottom:1px solid rgba(255,255,255,0.5);
  transition: background-color 0.3s, transform 0.3s;
}
header.scrolled { background-color: rgba(0,0,0,0.6); }

.logo { height:80%; display:flex; align-items:center; transition: transform 0.3s ease; margin-left:0; }
.logo img { height:100%; width:auto; }

.slider-wrapper { padding-top:70px; position:relative; overflow:hidden; }
.slider {
  display:flex; overflow-x:auto; gap:20px;
  padding:15px 15px 15px 0; cursor:grab;
  scroll-behavior:smooth; -webkit-overflow-scrolling:touch;
}
.slider:active { cursor:grabbing; }

.poster-card {
  position: relative;
  flex: 0 0 auto;
  width: 90vw;          /* ✅ take 90% of viewport width */
  max-width: 600px;     /* ✅ prevent it from getting too big on desktops */
  aspect-ratio: 16/9;
  border-radius: 12px;
  overflow: hidden;
  background: #111;
  transition: transform 0.3s;
  margin-left: 0;
}
.poster-card:first-child { margin-left:15px; }
.poster-card:hover { transform: scale(1.05); }
.upcoming-carousel-container {
  overflow-x: auto;
  padding-bottom: 20px;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

.upcoming-carousel-container::-webkit-scrollbar {
  display: none;
}
.upcoming-carousel {
  display: flex;
  gap: 15px;
}

.upcoming-carousel .upcoming-card:first-child {
  margin-left: 0; /* remove any left padding/margin for first card */
}
.upcoming-card {
  flex: 0 0 280px;
  aspect-ratio: 16/9;
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s;
  background: #111;
}

.upcoming-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: filter 0.3s;
  border-radius: 12px;
}

.upcoming-gradient {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40%;
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  pointer-events: none;
  transition: opacity 0.3s;
}

.upcoming-info {
  position: absolute;
  bottom: 10px;
  left: 15px;
  color: #fff;
  font-weight: bold;
  font-size: 0.9rem;
  text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
  z-index: 2;
  line-height: 1.2;
}

.upcoming-info .teams { display: block; }
.upcoming-info .datetime { display: block; font-weight: 300; font-size: 0.85rem; }

.upcoming-card.active img { filter: blur(5px); }
.upcoming-card.active .upcoming-overlay {
  opacity: 1;
  pointer-events: auto;
}

.upcoming-card.active .upcoming-info,
.upcoming-card.active .upcoming-gradient {
  opacity: 0;
}

.upcoming-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  color: #ccc;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 15px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
  font-family: 'Lato', sans-serif;
  font-size: 0.95rem;
  font-weight: 300;
}

.upcoming-overlay p { margin: 5px 0; }
.upcoming-overlay .title {
  color: #2196F3;
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 10px;
  text-shadow: 1px 1px 5px rgba(0,0,0,0.8);
}

/* Loader Styles */
.loader-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #212121;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

@keyframes rotateBall {
  0% { transform: rotateY(0deg) rotateX(0deg) rotateZ(0deg); }
  50% { transform: rotateY(360deg) rotateX(360deg) rotateZ(0deg); }
  100% { transform: rotateY(720deg) rotateX(720deg) rotateZ(360deg); }
}

@keyframes bounceBall {
  0% { transform: translateY(-70px) scale(1, 1); }
  15% { transform: translateY(-56px) scale(1, 1); }
  45% { transform: translateY(70px) scale(1, 1); }
  50% { transform: translateY(73.5px) scale(1, 0.92); }
  55% { transform: translateY(70px) scale(1, 0.95); }
  85% { transform: translateY(-56px) scale(1, 1); }
  95% { transform: translateY(-70px) scale(1, 1); }
  100% { transform: translateY(-70px) scale(1, 1); }
}

.ball {
  animation-name: bounceBall;
  animation-duration: 1.2s;
  animation-iteration-count: infinite;
  animation-timing-function: cubic-bezier(0.42, 0, 0.58, 1);
  border-radius: 50%;
  height: 60px;
  position: relative;
  transform: translateY(-70px);
  transform-style: preserve-3d;
  width: 60px;
  z-index: 1;
}

.ball::before {
  background: radial-gradient(circle at 36px 20px, #ff8c16, #b35100);
  border: 2px solid #333333;
  border-radius: 50%;
  content: "";
  height: calc(100% + 6px);
  left: -6px;
  position: absolute;
  top: -3px;
  transform: translateZ(1vmin);
  width: calc(100% + 6px);
}

.ball .inner {
  animation-name: rotateBall;
  animation-duration: 25s;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
  border-radius: 50%;
  height: 100%;
  position: absolute;
  transform-style: preserve-3d;
  width: 100%;
}

.ball .line::before,
.ball .line::after {
  border: 2px solid #333333;
  border-radius: 50%;
  content: "";
  height: 99%;
  position: absolute;
  width: 99%;
}

.ball .line::before {
  transform: rotate3d(0, 0, 0, 0);
}

.ball .line::after {
  transform: rotate3d(1, 0, 0, 90deg);
}

.ball .line--two::before {
  transform: rotate3d(0, 0, 0, 2deg);
}

.ball .line--two::after {
  transform: rotate3d(1, 0, 0, 88deg);
}

.ball .oval::before,
.ball .oval::after {
  border-top: 4px solid #333333;
  border-radius: 50%;
  content: "";
  height: 99%;
  position: absolute;
  width: 99%;
}

.ball .oval::before {
  transform: rotate3d(1, 0, 0, 45deg) translate3d(0, 0, 6px);
}

.ball .oval::after {
  transform: rotate3d(1, 0, 0, -45deg) translate3d(0, 0, -6px);
}

.ball .oval--two::before {
  transform: rotate3d(1, 0, 0, 135deg) translate3d(0, 0, -6px);
}

.ball .oval--two::after {
  transform: rotate3d(1, 0, 0, -135deg) translate3d(0, 0, 6px);
}

@keyframes bounceShadow {
  0% { filter: blur(3px); opacity: 0.6; transform: translateY(73px) scale(0.5, 0.5); }
  45% { filter: blur(1px); opacity: 0.9; transform: translateY(73px) scale(1, 1); }
  55% { filter: blur(1px); opacity: 0.9; transform: translateY(73px) scale(1, 1); }
  100% { filter: blur(3px); opacity: 0.6; transform: translateY(73px) scale(0.5, 0.5); }
}

.shadow {
  animation-name: bounceShadow;
  animation-duration: 1.2s;
  animation-iteration-count: infinite;
  animation-timing-function: cubic-bezier(0.42, 0, 0.58, 1);
  background: black;
  filter: blur(2px);
  border-radius: 50%;
  height: 6px;
  transform: translateY(73px);
  width: 54px;
}
/* Today Events Section */
#today-events-section {
  margin-top: 5px;
  width: 100%;
  overflow: hidden;
}

#today-events-section .section-title {
  font-size: 1.2rem;
  font-weight: 800;   /* extra bold */
  color: #fff;
  margin: 0 0 5px 15px;  /* Added left margin for proper alignment */
  padding: 0;         /* no padding */
}

#today-events-section .slider-wrapper {
  padding-top: 0;
  width: 100%;
}

#today-events-section .slider {
  display: flex;
  overflow-x: auto;
  gap: 15px;           /* gap between cards */
  padding: 0;  /* Added right padding for proper spacing */
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  width: 100%;
}

#today-events-section .slider::-webkit-scrollbar {
  display: none;
}

#today-events-section .poster-card {
  position: relative;
  flex: 0 0 auto;
  width: 260px;
  aspect-ratio: 16/9;
  border-radius: 10px;
  overflow: hidden;
  background: #111;
  transition: transform 0.3s;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* Remove left gradient that was appearing on the side */
#today-events-section .poster-card::before {
  display: none;
}

/* No margin on first card */
#today-events-section .poster-card:first-child {
  margin-left: 0;
}

#today-events-section .poster-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 10px;
}

#today-events-section .poster-card:hover {
  transform: scale(1.03);
}

/* Live indicator */
#today-events-section .live-indicator {
  position: absolute;
  top: 8px;
  left: 8px;
  background: red;
  color: white;
  font-size: 0.65rem;
  font-weight: bold;
  padding: 3px 8px;
  border-radius: 5px;
  animation: blink 1s infinite;
  z-index: 3;
}

@keyframes blink {
  50% {
    opacity: 0.7;
  }
}

/* Bottom gradient overlay - FIXED POSITION */
#today-events-section .poster-card::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40%; /* Increased height for better text visibility */
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  pointer-events: none;
  border-radius: 0 0 10px 10px; /* match card border-radius at bottom */
  z-index: 2;
} 
/* Bottom gradient overlay - stronger */
#today-events-section .poster-card::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40%; /* increased for better visibility */
  background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.2), transparent);
  pointer-events: none;
  border-radius: 0 0 10px 10px; /* match card border-radius at bottom */
  z-index: 2;
}

/* Highlights section */
.highlight-card {
  position: relative;
  flex: 0 0 260px;   /* ✅ fixed small card width */
  max-width: 260px;  /* ✅ prevents it from stretching */
  aspect-ratio: 16/9;
  border-radius: 12px;
  overflow: hidden;
  background: #222;
  cursor: pointer;
  scroll-snap-align: start;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  transition: transform 0.3s;
}
.highlight-card:hover { transform: scale(1.05); }

.highlight-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.gradient {
  position: absolute;
  bottom: 0; left: 0;
  width: 100%; height: 40%;
  background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
}

.highlight-title {
  position: absolute;
  bottom: 8px;
  left: 10px;
  right: 10px;
  font-size: 0.95rem;   /* ✅ same size as section title */
  font-weight: 700;     /* ✅ bold for emphasis */
  color: #fff;
  text-shadow: 1px 1px 4px rgba(0,0,0,0.9);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.poster-card img.poster-img { width:100%; height:100%; object-fit:cover; display:block; border-radius:12px; box-shadow: 0 0 6px rgba(255,255,255,0.05);}
.poster-card img.title-img {
  position:absolute; bottom:10px; left:-10px; width:200px; height:200px;
  object-fit:contain; z-index:2; pointer-events:none;
  box-shadow:0 12px 28px rgba(0,0,0,0.7);
}
.team-score { 
  font-size:0.75rem; 
  color:#ccc; 
  line-height:1.2; 
  font-weight: bold; /* make score bold */
}
.poster-meta-left {
  position:absolute; left:15px; bottom:70px; color:#fff;
  font-size:14px; font-weight:500; z-index:2; pointer-events:none; line-height:1.4;
}
.watch-btn {
  position:absolute; bottom:20px; left:20px;
  padding:10px 18px; font-weight:bold; border-radius:12px;
  border:none; color:#fff; background-color:#ff4500;
  box-shadow:0 8px 20px rgba(0,0,0,0.6); cursor:pointer;
  font-size:16px; z-index:2; transition: transform 0.2s ease;
}
.scroll-container { 
  display: flex; 
  gap: 18px; 
  overflow-x: auto; 
  padding: 10px 0; 
  scroll-behavior: smooth; 
  scrollbar-width: none; 
  padding-right: 40px; /* for peek */
}
.scroll-container::-webkit-scrollbar { display: none; }

.match-card { 
  flex: 0 0 280px; /* smaller than slider cards */
  max-width: 280px; 
  aspect-ratio:16/9;
  background: linear-gradient(145deg, #1f1f1f, #2c2c2c);
  border-radius:12px; 
  box-shadow:0 6px 16px rgba(0,0,0,0.7);
  padding:10px; 
  display:flex; 
  flex-direction:column; 
  justify-content:space-between; 
  transition: transform 0.3s, box-shadow 0.3s; 
}
.match-card:hover { transform: translateY(-5px); box-shadow:0 10px 24px rgba(0,0,0,0.85); }

.match-header { text-align:center; margin-bottom:8px; }
.match-header strong { font-size:0.95rem; color:#fff; }
.match-header div { font-size:0.8rem; color:#bbb; }

.status { display:inline-flex; align-items:center; gap:6px; margin-top:6px; font-size:0.75rem; padding:3px 8px; border-radius:10px; font-weight:bold; }
.status.live { background:#ff1744; color:#fff; }
.status.ended { background:#ff9800; color:#fff; }
.status.upcoming { background:#4CAF50; color:#fff; }

.teams { display:flex; justify-content:space-between; align-items:center; margin-top:8px; gap:10px; }
.team { flex:1; text-align:center; padding:6px; border-radius:10px; background: rgba(255,255,255,0.05); box-shadow: inset 0 0 5px rgba(255,255,255,0.05);}
.team img { width:60px; height:40px; margin-bottom:4px; border-radius:4px; object-fit:contain; background:#fff; }
.team-name { font-size:0.8rem; font-weight:bold; color:#f0f0f0; margin-bottom:2px; }
.team-score { font-size:0.75rem; color:#ccc; line-height:1.2; }
.watch-btn:hover { transform: scale(1.05); }

.modal {
  display:flex; opacity:0; visibility:hidden;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
  justify-content:center; align-items:center; z-index:2000;
  transition: opacity 0.3s, visibility 0.3s;
}
.modal.show { opacity:1; visibility:visible; }

.modal-content {
  background:#111; padding:25px 30px; border-radius:20px;
  width:360px; max-width:90%; text-align:center;
  transform:scale(0.9); transition: transform 0.3s;
}
.modal.show .modal-content { transform: scale(1); }

.modal-content h3 { margin-bottom:20px; font-size:22px; color:#fff; }
.modal-content .channel-btn {
  display:block; width:100%; padding:14px 0; margin:10px 0;
  background-color:#ff4500; color:#fff; font-weight:bold;
  border:none; border-radius:12px; cursor:pointer;
  box-shadow:0 8px 20px rgba(0,0,0,0.6); transition: transform 0.2s ease;
}
.modal-content .channel-btn:hover { transform:scale(1.05); }
.modal-content .close-btn {
  margin-top:15px; padding:12px 20px;
  background:#555; color:#fff; border:none; border-radius:12px;
  cursor:pointer; font-weight:bold; transition: transform 0.2s ease;
}
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.modal-content .close-btn:hover { transform:scale(1.05); }

.slider::-webkit-scrollbar { display:none; }
.slider { -ms-overflow-style:none; scrollbar-width:none; }

.poster-card::before {
  content:""; position:absolute; top:0; left:0; width:40%; height:100%;
  background:linear-gradient(to right, rgba(0,0,0,1), transparent);
  pointer-events:none; z-index:1;
}

.slider-dots { display:flex; justify-content:center; margin-top:15px; gap:8px; }
.dot { width:10px; height:10px; border-radius:50%; background-color:rgba(255,255,255,0.3); cursor:pointer; transition:0.3s;}
.dot.active { background-color:#ff4500; transform:scale(1.2);}
</style>
</head>
<body>
<!-- Loader -->
<div id="loader" class="loader-container">
  <div class="ball">
    <div class="inner">
      <div class="line"></div>
      <div class="line line--two"></div>
      <div class="oval"></div>
      <div class="oval oval--two"></div>
    </div>
  </div>
  <div class="shadow"></div>
</div>
<header>
  <div class="logo"><img src="https://crickmail.pages.dev/logo.png" alt="Logo"></div>
</header>

<div class="slider-wrapper">
  <div class="slider" id="posterSlider"></div>
  <div class="slider-dots" id="sliderDots"></div>
</div>

<section id="scoreboard-section" style="margin-top:20px;">
  <h2 style="font-size:1.2rem; font-weight:bold; color:#fff; margin-left:15px; margin-bottom:10px;">Asia Cup</h2>

  <div class="scroll-container" id="matches"></div>
</section>

<section id="today-events-section" style="margin-top:12px;">
  <h2 class="section-title">Today Events</h2>
  <div class="slider-wrapper">
    <div class="slider" id="todayEventsSlider"></div>
  </div>
</section>

<section id="upcoming-section" style="margin-top:10px;">
  <h2 style="font-size:1.2rem; font-weight:bold; color:#fff; margin-left:15px; margin-bottom:10px;">Upcoming Matches</h2>
  <div class="upcoming-carousel-container">
    <div class="upcoming-carousel" id="upcomingCarousel"></div>
  </div>
</section>

<section id="highlights-section" style="margin-top:10px;">
  <h2 style="font-size:1.2rem; font-weight:bold; color:#fff; margin-left:15px; margin-bottom:8px;">Highlights</h2>
  <div class="scroll-container" id="highlightContainer"></div>
</section>

<footer id="footer">
  <div class="footer-content">
    <p>&copy; 2025 Allrounder. All Rights Reserved.</p>
  </div>
</footer>

<div class="modal" id="channelModal">
  <div class="modal-content">
    <h3>Select Your Stream</h3>
    <div id="channelButtons"></div>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<script>
const header = document.querySelector('header');
const slider = document.getElementById('posterSlider');
const sliderDots = document.getElementById('sliderDots');
const modal = document.getElementById('channelModal');
const channelContainer = document.getElementById('channelButtons');

let currentChannels = [], autoSlideInterval, currentSlide = 0, totalSlides = 0;
let userScrolling = false, userScrollingTimeout;
let userInteractedTimeout = null;

// Header scroll effect
window.addEventListener('scroll', ()=>{
  if(window.scrollY>50) header.classList.add('scrolled'); 
  else header.classList.remove('scrolled');
  userScrolling = true;
  clearTimeout(userScrollingTimeout);
  userScrollingTimeout = setTimeout(()=>{ userScrolling=false; },100);
});

// Parse poster.date + poster.start_time → IST Date object
function parsePosterDateTime(poster) {
  const parts = poster.date.split(" "); // [DD, Mon, YYYY]
  const day = parseInt(parts[0]);
  const monthNames = {
    "Jan":0,"Feb":1,"Mar":2,"Apr":3,"May":4,"Jun":5,
    "Jul":6,"Aug":7,"Sep":8,"Oct":9,"Nov":10,"Dec":11
  };
  const month = monthNames[parts[1]];
  const year = parseInt(parts[2]);

  let [hour, minute] = poster.start_time.split(":");
  let period = "AM";
  if (minute.includes(" ")) {
    [minute, period] = minute.split(" ");
  }
  hour = parseInt(hour);
  minute = parseInt(minute);
  if (period === "PM" && hour < 12) hour += 12;
  if (period === "AM" && hour === 12) hour = 0;

  // Convert to IST Date
  return new Date(Date.UTC(year, month, day, hour - 5, minute - 30));
}

function isPosterLive(poster) {
  const now = new Date();
  const matchDateTime = parsePosterDateTime(poster);
  return now >= matchDateTime; // live if current time >= start time
}
// Auto slide every 5 seconds
function startAutoSlide(){
  clearInterval(autoSlideInterval);
  autoSlideInterval = setInterval(()=>{
    if(!drag.isDragging && !userScrolling){
      currentSlide = (currentSlide + 1) % totalSlides;
      scrollToSlide(currentSlide);
    }
  },5000);
}

function scrollToSlide(index){
  const cards = slider.querySelectorAll('.poster-card');
  if(!cards.length) return;
  currentSlide = index;
  const sliderRect = slider.getBoundingClientRect();
  const cardRect = cards[currentSlide].getBoundingClientRect();
  const offset = cardRect.left - sliderRect.left - (sliderRect.width - cardRect.width)/2;
  slider.scrollLeft += offset;
  updateDots();
}

function updateDots(){
  const dots = sliderDots.querySelectorAll('.dot');
  dots.forEach((d,i)=>d.classList.toggle('active', i===currentSlide));
}

function createDots(count){
  sliderDots.innerHTML='';
  for(let i=0;i<count;i++){
    const dot = document.createElement('div');
    dot.className='dot';
    if(i===0) dot.classList.add('active');
    dot.addEventListener('click', ()=>{ 
      scrollToSlide(i); 
      pauseAutoSlideOnInteraction();
    });
    sliderDots.appendChild(dot);
  }
}

// Pause auto-slide 10 sec on interaction
function pauseAutoSlideOnInteraction(){
  clearInterval(autoSlideInterval);
  clearTimeout(userInteractedTimeout);
  userInteractedTimeout = setTimeout(startAutoSlide,10000);
}

// Smooth drag using requestAnimationFrame
const drag = { isDragging:false, startX:0, scrollLeft:0, rafId:null };
function dragMove(e){
  if(!drag.isDragging) return;
  const x = e.type.includes('touch') ? e.touches[0].pageX : e.pageX;
  const walk = drag.startX - x;
  if(drag.rafId) cancelAnimationFrame(drag.rafId);
  drag.rafId = requestAnimationFrame(()=>{ slider.scrollLeft = drag.scrollLeft + walk; });
}
slider.addEventListener('mousedown', e=>{ drag.isDragging=true; drag.startX=e.pageX; drag.scrollLeft=slider.scrollLeft; pauseAutoSlideOnInteraction(); });
slider.addEventListener('mousemove', dragMove);
slider.addEventListener('mouseup', ()=>{ drag.isDragging=false; });
slider.addEventListener('mouseleave', ()=>{ drag.isDragging=false; });
slider.addEventListener('touchstart', e=>{ drag.isDragging=true; drag.startX=e.touches[0].pageX; drag.scrollLeft=slider.scrollLeft; pauseAutoSlideOnInteraction(); });
slider.addEventListener('touchmove', dragMove);
slider.addEventListener('touchend', ()=>{ drag.isDragging=false; });

// Fetch posters
fetch('https://raw.githubusercontent.com/Cricketstan/Allrounder-/refs/heads/main/main-poster.json')
  .then(res => res.json())
  .then(data => {
    // Only take the first 3 posters
    const posters = data.posters.slice(0, 3); 
    totalSlides = posters.length;
    createDots(totalSlides);

    posters.forEach(poster => {
      const card = document.createElement('div');
      card.className = 'poster-card';
      const live = isPosterLive(poster);
      const btnLabel = live ? 'Watch Now' : 'Upcoming'; 

      card.innerHTML = `
        <img class="poster-img" src="${poster.poster_link}">
        <img class="title-img" src="${poster.title}">
        <div class="poster-meta-left">${poster.year} • ${poster.language} • ${poster.rating} • ${poster.category}</div>
        <button class="watch-btn">${btnLabel}</button>
      `;
      slider.appendChild(card);

      card.querySelector('.watch-btn').addEventListener('click', () => {
        if(live){ 
          currentChannels = poster.watch_now; 
          openModal(); 
        } else { 
          alert(`Match starts at ${poster.start_time} IST`); 
        }
      });
    });

    startAutoSlide();
  });
// Modal
function openModal(){
  channelContainer.innerHTML = '';
  currentChannels.forEach((c) => {
    const btn = document.createElement('button');
    btn.className = 'channel-btn';
    btn.textContent = c.name;
    btn.onclick = () => window.open(c.id, '_blank'); // ✅ use actual channel ID from JSON
    channelContainer.appendChild(btn);
  });
  modal.classList.add('show');
  clearInterval(autoSlideInterval);
}
function closeModal(){
  modal.classList.remove('show');
  setTimeout(startAutoSlide,300);
}
async function fetchMatches() {
  try {
    const res = await fetch('https://m.cricbuzz.com/api/home');
    const data = await res.json();
    renderMatches(data.matches);
    startAutoScroll();
  } catch(err) {
    console.error("Error fetching matches:", err);
    document.getElementById('matches').innerHTML = '<p>Error fetching match data.</p>';
  }
}

function formatInnings(inn) { if (!inn) return ""; return `${inn.runs}/${inn.wickets || 0} (${inn.overs} ov)`; }

function renderMatches(matches) {
  const container = document.getElementById('matches');
  container.innerHTML = '';
  matches.forEach(item => {
    const m = item.match.matchInfo;
    const score = item.match.matchScore || {};
    const matchCard = document.createElement('div');
    matchCard.className = `match-card`;

    let team1Score = "Yet to Bat";
    let team2Score = "Yet to Bat";
    if (score.team1Score) { team1Score = formatInnings(score.team1Score.inngs1); if(score.team1Score.inngs2) team1Score += `<br>${formatInnings(score.team1Score.inngs2)}`; }
    if (score.team2Score) { team2Score = formatInnings(score.team2Score.inngs1); if(score.team2Score.inngs2) team2Score += `<br>${formatInnings(score.team2Score.inngs2)}`; }

    let statusClass = "upcoming", statusIcon = "schedule", statusText = m.stateTitle;
    if (m.state === "In Progress") { statusClass = "live"; statusIcon = "live_tv"; statusText = "LIVE NOW"; }
    else if (m.state === "Complete") { statusClass = "ended"; statusIcon = "emoji_events"; statusText = "Ended – " + m.status; }

    matchCard.innerHTML = `
      <div class="match-header">
        <div><strong>${m.seriesName}</strong></div>
        <div>${m.matchDesc}</div>
        <div class="status ${statusClass}"><span class="material-icons">${statusIcon}</span> ${statusText}</div>
      </div>
      <div class="teams">
        <div class="team">
          <img src="https://static.cricbuzz.com/a/img/v1/200x150/i1/c${m.team1.imageId}/${m.team1.teamName}.jpg" alt="${m.team1.teamName}">
          <div class="team-name">${m.team1.teamSName}</div>
          <div class="team-score">${team1Score}</div>
        </div>
        <div class="team">
          <img src="https://static.cricbuzz.com/a/img/v1/200x150/i1/c${m.team2.imageId}/${m.team2.teamName}.jpg" alt="${m.team2.teamName}">
          <div class="team-name">${m.team2.teamSName}</div>
          <div class="team-score">${team2Score}</div>
        </div>
      </div>
    `;
    container.appendChild(matchCard);
  });
}

// Auto-scroll with user-friendly pause
function startAutoScroll() {
  const container = document.getElementById('matches');
  const cardWidth = 340 + 18; // width + gap
  let userScrolling = false, scrollTimeout;

  function scrollStep() {
    if (!userScrolling) {
      if (container.scrollLeft + container.clientWidth >= container.scrollWidth) container.scrollTo({ left: 0, behavior: 'smooth' });
      else container.scrollBy({ left: cardWidth, behavior: 'smooth' });
    }
  }

  const interval = setInterval(scrollStep, 10000);

  container.addEventListener('scroll', () => {
    userScrolling = true;
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => { userScrolling = false; }, 5000); // resume after 5s
  });
}

fetchMatches();
const upcomingCarousel = document.getElementById('upcomingCarousel');
const upcomingApi = 'https://raw.githubusercontent.com/Cricketstan/Allrounder-/refs/heads/main/upcomingevnets.json';

// Convert match date & time to IST Date object
function getISTDate(dateStr, timeStr) {
  const parts = dateStr.split(' ');
  const day = parseInt(parts[2]);
  const monthNames = {"Jan":0,"Feb":1,"Mar":2,"Apr":3,"May":4,"Jun":5,"Jul":6,"Aug":7,"Sep":8,"Oct":9,"Nov":10,"Dec":11};
  const month = monthNames[parts[1]];
  const year = parseInt(parts[3]);

  let [hour, minute] = timeStr.split(':');
  let period = 'AM';
  if (minute.includes(' ')) {
    [minute, period] = minute.split(' ');
  }
  hour = parseInt(hour);
  minute = parseInt(minute);
  if (period === 'PM' && hour < 12) hour += 12;
  if (period === 'AM' && hour === 12) hour = 0;

  return new Date(Date.UTC(year, month, day, hour - 5, minute - 30));
}

// Fetch upcoming matches
fetch(upcomingApi)
  .then(res => res.json())
  .then(data => {
    const now = new Date();
    data.upcomingMatches.forEach(match => {
      const matchDateTime = getISTDate(match.date, match.time);
      if (matchDateTime < now) return; // skip past matches

      const card = document.createElement('div');
      card.className = 'upcoming-card';
      card.innerHTML = `
        <img src="${match.poster}" alt="${match.title}">
        <div class="upcoming-gradient"></div>
        <div class="upcoming-info">
          <span class="teams">${match.team1} vs ${match.team2}</span>
          <span class="datetime">${match.date} | ${match.time}</span>
        </div>
        <div class="upcoming-overlay">
          <div class="title">${match.title}</div>
          <p>Venue: ${match.venue}</p>
          <p>Start: ${match.date} ${match.time}</p>
          <p>Teams: ${match.team1} vs ${match.team2}</p>
        </div>
      `;
      upcomingCarousel.appendChild(card);

      // Click to toggle blur overlay
      card.addEventListener('click', () => {
        card.classList.toggle('active');
      });

      // Remove card when match starts
      const interval = setInterval(() => {
        if (matchDateTime <= new Date()) {
          card.remove();
          clearInterval(interval);
        }
      }, 30000); // check every 30 seconds
    });
  })
  .catch(err => {
    console.error('Error fetching upcoming matches:', err);
  });
async function loadHighlights() {
  const url = "https://proxy-d969.onrender.com/raw?url=" +
    encodeURIComponent("https://acc-matchcentre.s3-ap-south-1.amazonaws.com/cpanel/client_14/2025/mediadoc/videos/1/videos.js?v=1756540254");

  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.replace(/^onVideos\(/, "").replace(/\);$/, ""));
    const container = document.getElementById("highlightContainer");

    json.videos.forEach(video => {
      const card = document.createElement("div");
      card.className = "highlight-card";
      card.innerHTML = `
        <img src="${video.Image}" alt="${video.Title}">
        <div class="gradient"></div>
        <div class="highlight-title">${video.Title}</div>
      `;
      card.addEventListener("click", () => {
        window.location.href =
          "highlights/player.html?src=" + encodeURIComponent(video.MediaData.videos) +
          "&title=" + encodeURIComponent(video.Title);
      });
      container.appendChild(card);
    });
  } catch (e) {
    console.error("Error loading highlights:", e);
  }
}

loadHighlights();
// --- TODAY EVENTS SECTION ---
const todaySlider = document.getElementById("todayEventsSlider");
let todayInterval;

function todayStartAuto(){
  clearInterval(todayInterval);
  todayInterval=setInterval(()=>{
    if(!todaySlider.matches(":hover")){
      todaySlider.scrollBy({left:280, behavior:"smooth"});
      if(todaySlider.scrollLeft + todaySlider.clientWidth >= todaySlider.scrollWidth){
        todaySlider.scrollTo({left:0, behavior:"smooth"});
      }
    }
  },5000);
}

function loadTodayEvents(){
  fetch("https://raw.githubusercontent.com/Cricketstan/Allrounder-/refs/heads/main/main-poster.json")
    .then(res=>res.json())
    .then(data=>{
      const liveEvents = [];
      const upcomingEvents = [];

      data.posters.forEach(poster=>{
        const live = isPosterLive(poster);
        if(live) liveEvents.push({...poster, live:true});
        else upcomingEvents.push({...poster, live:false});
      });

      // If live exists -> only show live, else show upcoming
      const eventsToShow = liveEvents.length ? liveEvents : upcomingEvents;

      todaySlider.innerHTML="";

      eventsToShow.forEach(ev=>{
        const card=document.createElement("div");
        card.className="poster-card";
        card.innerHTML=`<img src="${ev.poster_link}" alt="event">`;

        if(ev.live){
          const liveTag=document.createElement("div");
          liveTag.className="live-indicator";
          liveTag.textContent="LIVE";
          card.appendChild(liveTag);

          // LIVE → open modal
          card.addEventListener("click", ()=>{
            currentChannels = ev.watch_now;
            openModal();
          });

        } else {
          // Upcoming → show alert
          card.addEventListener("click", ()=>{
            alert("Match not live yet. Please check back later.");
          });
        }

        todaySlider.appendChild(card);
      });

      todayStartAuto();
    });
}

loadTodayEvents();
  // Function to show the loader
function showLoader() {
  document.getElementById('loader').style.display = 'flex';
}

// Function to hide the loader
function hideLoader() {
  document.getElementById('loader').style.display = 'none';
}

// Show loader when page starts loading
showLoader();

// Hide loader when page is fully loaded
window.addEventListener('load', function() {
  // Add a small delay for better UX
  setTimeout(hideLoader, 1000);
});
</script>

</body>
</html>
