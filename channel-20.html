<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title></title>

  <!-- Shaka Player -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" />

  <style>
    body { margin: 0; background: #000; }
    #video { width: 100%; height: 100vh; background: #000; }
    #qualitySelector { position: absolute; top: 10px; right: 10px; z-index: 100; }

    /* Popup Styles */
    .popup-backdrop {
      position: fixed;
      z-index: 9999;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.3s;
    }
    .popup {
      background: #23272f;
      border-radius: 14px;
      padding: 32px 16px 20px 16px;
      max-width: 96vw;
      width: 350px;
      box-shadow: 0px 6px 30px rgba(0,0,0,0.25);
      text-align: center;
    }
    .popup h2 {
      color: #fff;
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 10px;
      letter-spacing: 1px;
    }
    .popup .desc {
      color: #fff;
      font-size: 1.08rem;
      margin-bottom: 14px;
    }
    .popup .wa-text {
      color: #fff;
      font-size: 0.99rem;
      margin-bottom: 20px;
      opacity: 0.85;
    }
    .popup .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .popup .btn {
      border: none;
      border-radius: 8px;
      font-size: 1.05rem;
      font-weight: 600;
      padding: 10px 20px;
      min-width: 120px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      color: #fff;
    }
    .popup .btn.green {
      background: #25D366;
    }
    .popup .btn.green:hover {
      background: #1fa855;
    }
    .popup .btn.red {
      background: #e53935;
    }
    .popup .btn.red:hover {
      background: #b71c1c;
    }

    @media (max-width: 480px) {
      .popup { width: 97vw; padding: 18px 2vw 15px 2vw; }
      .popup h2 { font-size: 1.12rem; }
      .popup .desc, .popup .wa-text { font-size: 0.98rem; }
      .popup .btn { font-size: 1rem; min-width: 90px; padding: 9px 10px;}
    }
  </style>
</head>
<body>

  <video id="video" autoplay controls style="display:none"></video>
  <select id="qualitySelector" style="display:none"></select>

  <!-- Popup Modal -->
  <div class="popup-backdrop" id="popup-backdrop">
    <div class="popup">
      <h2>Support us</h2>
      <div class="desc">To continue watching, please join our WhatsApp channel or confirm you have already joined.</div>
      <div class="wa-text">Join WhatsApp Channel</div>
      <div class="buttons">
        <button class="btn green" id="join-now-btn">Join Now</button>
        <button class="btn red" id="already-joined-btn">Already Joined</button>
      </div>
    </div>
  </div>

  <script>
    // Popup logic
    function closePopupAndShowVideo() {
      document.getElementById('popup-backdrop').style.display = 'none';
      document.getElementById('video').style.display = '';
      document.getElementById('qualitySelector').style.display = '';
      // Start the video if it was paused
      var vid = document.getElementById('video');
      if (vid.paused) vid.play();
    }
    document.getElementById('already-joined-btn').onclick = closePopupAndShowVideo;
    document.getElementById('join-now-btn').onclick = function() {
      window.open('https://whatsapp.com/channel/0029VaeylYYBPzjVNomWuZ0T', '_blank');
      closePopupAndShowVideo();
    };

    // Prevent video from loading until popup is gone
    let shakaPlayerInit = null;
    function initApp() {
      shaka.polyfill.installAll();

      if (!shaka.Player.isBrowserSupported()) {
        console.error("Browser not supported!");
        return;
      }

      const video = document.getElementById("video");
      const player = new shaka.Player(video);
      const qualitySelector = document.getElementById("qualitySelector");

      // DRM Config
      player.configure({
        drm: {
          clearKeys: {
            "8268467a7a974698b18c9e63b13f73a4": "6affb3ad6e781bc4afafad402e1d4510"
          }
        }
      });

      player.load("https://sundirectgo-live.pc.cdn.bitgravity.com/hd21/dth.mpd").then(function() {
        // Get available video tracks
        const tracks = player.getVariantTracks().filter(t => t.videoId !== null);
        tracks.forEach((t, i) => {
          const option = document.createElement("option");
          option.value = i;
          option.text = `${t.height}p - ${t.bandwidth / 1000} kbps`;
          qualitySelector.appendChild(option);
        });

        // Default to 396p if available
        let defaultTrackIndex = tracks.findIndex(t => t.height === 396);
        if (defaultTrackIndex === -1) {
          defaultTrackIndex = 0;
        }
        player.selectVariantTrack(tracks[defaultTrackIndex], true);
        qualitySelector.selectedIndex = defaultTrackIndex;

        // Change quality on selection
        qualitySelector.addEventListener("change", () => {
          const track = tracks[qualitySelector.value];
          player.selectVariantTrack(track, true);
        });
      }).catch(function(e) {
        console.error("Error loading video", e);
      });
    }

    // Wait until popup is closed before init video
    document.addEventListener("DOMContentLoaded", function() {
      // Video and quality selector will show after popup action
      // So call initApp only when popup is gone
      // (Otherwise, video may start loading in background)
    });
    // Attach to both buttons
    document.getElementById('already-joined-btn').addEventListener('click', function() {
      setTimeout(initApp, 300); // Small delay to ensure popup hidden
    });
    document.getElementById('join-now-btn').addEventListener('click', function() {
      setTimeout(initApp, 300);
    });
  </script>
</body>
</html>
